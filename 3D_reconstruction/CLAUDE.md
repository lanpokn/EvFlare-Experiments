# 3D Reconstruction with Event Camera Simulation Project

## é¡¹ç›®æ€»ä½“æž¶æž„
è¿™æ˜¯ä¸€ä¸ªå®Œæ•´çš„äº‹ä»¶ç›¸æœº3Dé‡å»ºå®žéªŒé¡¹ç›®ï¼ŒåŒ…å«æ ¸å¿ƒPipelineï¼š
1. **æ•°æ®é›†å¤„ç†**: åˆå¹¶ç‚«å…‰å’Œæ­£å¸¸å…‰ç…§æ•°æ®é›† âœ…å·²å®Œæˆ
2. **å›¾åƒé¢„å¤„ç†**: trainå›¾åƒ â†’ DVSä»¿çœŸè¾“å…¥æ ¼å¼ âœ…å·²å®Œæˆ  
3. **DVSäº‹ä»¶ä»¿çœŸ**: å›¾åƒåºåˆ— â†’ äº‹ä»¶æ•°æ® âœ…å·²å®Œæˆ
4. **æ ¼å¼è½¬æ¢**: DVS â†’ EVREAL + H5æ ¼å¼ âœ…å·²å®Œæˆ
5. **å›¾åƒé‡å»º**: EVREALäº‹ä»¶é‡å»º ðŸ”„éƒ¨åˆ†å®Œæˆ(çŽ¯å¢ƒé—®é¢˜)
6. **æ—¶é—´æˆ³å¯¹é½**: åŽŸå§‹å›¾åƒ-äº‹ä»¶-é‡å»ºå›¾åƒå¯¹é½ ðŸ“‹å¾…å®žæ–½

## ðŸŽ¯ å½“å‰å®žéªŒçŠ¶æ€ï¼ˆ2025-09-19æ›´æ–°ï¼‰

### âœ… å·²å®Œæˆæ¨¡å—
1. **Pipelineæž¶æž„è®¾è®¡** (`pipeline_architecture.py`)
   - å®Œæ•´çš„æ•°æ®æµå’ŒæŽ¥å£å®šä¹‰
   - æ”¯æŒDVSã€EVREALã€H5ä¸‰ç§æ ¼å¼çš„è½¬æ¢

2. **å›¾åƒé¢„å¤„ç†æ¨¡å—** (`modules/image_preprocessor.py`)
   - lego/train (200å¼ flareç‰ˆæœ¬) â†’ DVSè¾“å…¥æ ¼å¼
   - è‡ªåŠ¨ç”Ÿæˆinfo.txtå’Œæ—¶é—´æˆ³
   - æ—¶é—´é—´éš”: 1ms (1000Î¼s)

3. **DVSä»¿çœŸå™¨å°è£…** (`modules/dvs_simulator.py`)
   - æˆåŠŸä»¿çœŸç”Ÿæˆ 4,771,501 ä¸ªäº‹ä»¶
   - æ—¶é—´èŒƒå›´: 0-479Î¼sï¼Œç©ºé—´: 640x480
   - æžæ€§åˆ†å¸ƒ: ON=2,457,813, OFF=2,313,688
   - è¾“å‡ºä½ç½®: `datasets/lego/events_dvs/lego_train_events.txt`

4. **æ ¼å¼è½¬æ¢å™¨** (`modules/format_converter.py`)
   - DVS txt â†’ EVREAL npyæ ¼å¼ (events_ts/xy/p.npy)
   - DVS txt â†’ H5æ ¼å¼ (events/t/x/y/p)
   - æ”¯æŒåŒå‘è½¬æ¢ (H5 â†” DVS, H5 â†” EVREAL)
   - è¾“å‡ºä½ç½®: `datasets/lego/events_evreal/sequence/`

### âœ… å·²å®Œæˆæ¨¡å— 
5. **EVREALé›†æˆæ¨¡å—** (`modules/evreal_integration.py`)
   - **å½“å‰çŠ¶æ€**: âœ… Pipelineè°ƒç”¨æˆåŠŸï¼ŒâŒ é‡å»ºå›¾åƒç”Ÿæˆé—®é¢˜
   - **å·²è§£å†³é—®é¢˜**:
     * è·¨å¹³å°è·¯å¾„å…¼å®¹æ€§ (WindowsPathåœ¨WSLä¸­çš„é—®é¢˜) âœ…
     * EVREALä¾èµ–å®‰è£… (tabulate, yachalk, pyiqaç­‰) âœ… 
     * æ•°æ®é›†é…ç½®æ ¼å¼åŒ¹é…EVREALæ ‡å‡† âœ…
     * ç›®å½•ç»“æž„è°ƒæ•´ (events_evreal/sequence/) âœ…
     * çœŸå€¼å›¾åƒé…ç½® (lego/testå¤åˆ¶åˆ°sequence/images/) âœ…
     * PNGâ†’numpyè½¬æ¢åŠŸèƒ½é›†æˆ âœ…
   - **å½“å‰æ ¸å¿ƒé—®é¢˜**: âŒ **EVREALé‡å»ºå›¾åƒæœªç”Ÿæˆ**
     * EVREALè¿è¡ŒæˆåŠŸï¼Œä½†åªç”Ÿæˆç©ºçš„æŒ‡æ ‡æ–‡ä»¶
     * ç¼ºå°‘é‡å»ºçš„PNGå›¾åƒæ–‡ä»¶ï¼ˆframe_*.pngï¼‰
     * å¯èƒ½åŽŸå› : E2VIDæ¨¡åž‹æ–‡ä»¶ã€æ•°æ®æ ¼å¼ã€è·¯å¾„é—®é¢˜

6. **ä¸€é”®å¼ä¸»æŽ§Pipeline** (`run_full_pipeline.py`)
   - **å½“å‰çŠ¶æ€**: âœ… 100%å®Œæˆï¼ŒçœŸæ­£ä¸€é”®è¿è¡Œ
   - **åŠŸèƒ½**: ä»Žlego_flare+lego_normal â†’ å®Œæ•´é‡å»ºæµç¨‹
   - **éªŒè¯ç»“æžœ**: 
     * æ•°æ®é›†åˆå¹¶ âœ…
     * å›¾åƒé¢„å¤„ç† âœ…  
     * DVSäº‹ä»¶ä»¿çœŸ âœ…
     * æ ¼å¼è½¬æ¢ âœ…
     * EVREALè°ƒç”¨ âœ…
   - **é—®é¢˜**: æœ€ç»ˆé‡å»ºå›¾åƒæ•°é‡ä¸º0

### ðŸ“‹ å¾…å®žæ–½æ¨¡å—  
6. **æ—¶é—´æˆ³å¯¹é½ç³»ç»Ÿ**
   - ç¡®ä¿åŽŸå§‹å›¾åƒã€ä»¿çœŸäº‹ä»¶ã€é‡å»ºå›¾åƒæ—¶é—´æˆ³å®Œå…¨å¯¹åº”
   - æ–‡ä»¶å‘½åè§„èŒƒåŒ–
   
7. **ä¸»æŽ§Pipelineè„šæœ¬**
   - ç«¯åˆ°ç«¯è‡ªåŠ¨åŒ–æ‰§è¡Œ
   - é…ç½®ç®¡ç†ç³»ç»Ÿ
   
8. **ç»“æžœéªŒè¯æ¨¡å—**
   - æ–‡ä»¶å®Œæ•´æ€§æ£€æŸ¥
   - æ—¶é—´æˆ³ä¸€è‡´æ€§éªŒè¯
   - å›¾åƒè´¨é‡è¯„ä¼°

## ðŸš¨ é‡åˆ°çš„æ ¸å¿ƒé—®é¢˜

### 1. è·¯å¾„ç®¡ç†é—®é¢˜ (å·²è§£å†³)
- **é—®é¢˜**: DVSè¾“å‡ºåœ¨tempç›®å½•ï¼Œä¸ç¬¦åˆæ•°æ®å­˜å‚¨è§„èŒƒ
- **è§£å†³**: ä¿®æ­£ä¸ºç›´æŽ¥è¾“å‡ºåˆ° `datasets/lego/events_dvs/`
- **çŠ¶æ€**: å·²æ›´æ–°æ‰€æœ‰ç›¸å…³æ¨¡å—çš„è·¯å¾„å¼•ç”¨

## ðŸŽ¯ å®žéªŒå·¥ä½œæµç¨‹ï¼ˆæ›´æ–°ç‰ˆï¼‰

### é˜¶æ®µ1: æ•°æ®å‡†å¤‡ âœ…å®Œæˆ
```bash
# æ•°æ®é›†åˆå¹¶
python merge_datasets.py

# å›¾åƒé¢„å¤„ç†
python modules/image_preprocessor.py
```

### é˜¶æ®µ2: äº‹ä»¶ä»¿çœŸ âœ…å®Œæˆ  
```bash
# DVSäº‹ä»¶ä»¿çœŸ
python modules/dvs_simulator.py

# æ ¼å¼è½¬æ¢
python modules/format_converter.py
```

### é˜¶æ®µ3: å›¾åƒé‡å»º âœ…å¯ä»¥æ‰§è¡Œ
```bash
# EVREALå›¾åƒé‡å»º
python modules/evreal_integration.py
```

### é˜¶æ®µ4: ç»“æžœåˆ†æž ðŸ“‹å¾…å®žæ–½
- æ—¶é—´æˆ³å¯¹é½éªŒè¯
- é‡å»ºè´¨é‡è¯„ä¼°
- ä¸ŽåŽŸå§‹å›¾åƒå¯¹æ¯”

## ðŸ“ å½“å‰æ•°æ®ç»“æž„
```
datasets/lego/
â”œâ”€â”€ train/                  # åŽŸå§‹è®­ç»ƒå›¾åƒ (200å¼ )
â”œâ”€â”€ test/                   # åŽŸå§‹æµ‹è¯•å›¾åƒ (200å¼ ) 
â”œâ”€â”€ events_dvs/            # DVSåŽŸå§‹äº‹ä»¶æ•°æ®
â”‚   â””â”€â”€ lego_train_events.txt
â”œâ”€â”€ events_evreal/         # EVREALæ ‡å‡†æ ¼å¼
â”‚   â”œâ”€â”€ events_ts.npy
â”‚   â”œâ”€â”€ events_xy.npy  
â”‚   â”œâ”€â”€ events_p.npy
â”‚   â””â”€â”€ metadata.json
â”œâ”€â”€ events_h5/             # H5æ ¼å¼
â”‚   â””â”€â”€ lego_sequence.h5
â””â”€â”€ reconstruction/        # é‡å»ºç»“æžœç›®å½•(é¢„ç•™)
    â””â”€â”€ evreal_*/
```

## âš ï¸ é‡è¦æé†’
- **ä¸¥é‡é—®é¢˜å¿…é¡»åœä¸‹åé¦ˆ**: çŽ¯å¢ƒä¾èµ–ã€å†…å­˜ä¸è¶³ã€å…³é”®æ–‡ä»¶ä¸¢å¤±ç­‰
- **è·¯å¾„ä¸€è‡´æ€§**: æ‰€æœ‰æ¨¡å—å·²æ›´æ–°ä½¿ç”¨æ•°æ®é›†ç›®å½•è€Œéžtemp
- **æ—¶é—´æˆ³æ ¼å¼**: DVSä½¿ç”¨å¾®ç§’ï¼ŒEVREALä½¿ç”¨ç§’ï¼ŒH5ä¿æŒå¾®ç§’
- **æ–‡ä»¶å‘½å**: ä¸¥æ ¼æŒ‰ç…§ `lego_train_events.txt` ç­‰è§„èŒƒå‘½å
- **ðŸš¨ çŽ¯å¢ƒä¿æŠ¤é“å¾‹**: ç»å¯¹ä¸å¯ä»¥ç ´åcondaçŽ¯å¢ƒä¸­çš„å·²æœ‰åŒ…ï¼åªèƒ½æ·»åŠ æ–°åŒ…ï¼Œä¸èƒ½å‡çº§/é™çº§çŽ°æœ‰åŒ…ï¼

## æ•°æ®é›†ç»“æž„

### åŽŸå§‹æ•°æ®é›†
- `lego_flare/`: å¸¦ç‚«å…‰çš„legoæ•°æ®é›†
- `lego_normal/`: æ— ç‚«å…‰çš„legoæ•°æ®é›†
- ä¸¤ä¸ªæ•°æ®é›†çš„ä½å§¿ï¼ˆtransform_matrixï¼‰å®Œå…¨ç›¸åŒ
- æ¯ä¸ªæ•°æ®é›†åŒ…å«200å¼ è®­ç»ƒå›¾ç‰‡

### åˆå¹¶åŽæ•°æ®é›†
- `lego/`: åˆå¹¶åŽçš„å®Œæ•´æ•°æ®é›†
  - `train/`: 200å¼ è®­ç»ƒå›¾ç‰‡ï¼ˆæ¥è‡ªlego_flareï¼ŒåŒ…å«ç‚«å…‰ï¼‰
  - `test/`: 200å¼ æµ‹è¯•å›¾ç‰‡ï¼ˆæ¥è‡ªlego_normalï¼Œæ— ç‚«å…‰ï¼‰
  - `transforms_train.json`: è®­ç»ƒé›†ä½å§¿æ–‡ä»¶
  - `transforms_test.json`: æµ‹è¯•é›†ä½å§¿æ–‡ä»¶
  - `points3d.ply`: 3Dç‚¹äº‘æ–‡ä»¶

### è·¯å¾„ä¿®æ­£é—®é¢˜
åŽŸå§‹transformsæ–‡ä»¶ä¸­çš„è·¯å¾„æ ¼å¼ä¸º `"train\\r_00001"`ï¼Œä½†å®žé™…æ–‡ä»¶åä¸º `0001.png`ã€‚
åˆå¹¶è„šæœ¬å·²è‡ªåŠ¨ä¿®æ­£ä¸ºæ­£ç¡®æ ¼å¼ï¼š`"train/0001"` å’Œ `"test/0001"`ã€‚

## è„šæœ¬æ–‡ä»¶

### merge_datasets.py
æ•°æ®é›†åˆå¹¶è„šæœ¬ï¼ŒåŠŸèƒ½åŒ…æ‹¬ï¼š
1. è‡ªåŠ¨æ£€æµ‹æ‰€æœ‰ `*_flare` å’Œ `*_normal` æ•°æ®é›†å¯¹
2. å°†flareç‰ˆæœ¬ä½œä¸ºè®­ç»ƒé›†ï¼Œnormalç‰ˆæœ¬ä½œä¸ºæµ‹è¯•é›†
3. ä¿®æ­£transformsæ–‡ä»¶ä¸­çš„è·¯å¾„æ ¼å¼é”™è¯¯
4. éªŒè¯åˆå¹¶ç»“æžœçš„å®Œæ•´æ€§

ä½¿ç”¨æ–¹æ³•ï¼š
```bash
python3 merge_datasets.py
```

## å®žéªŒè®¾è®¡æ€è·¯
- è®­ç»ƒé˜¶æ®µï¼šä½¿ç”¨å¸¦ç‚«å…‰çš„å›¾ç‰‡è®­ç»ƒæ¨¡åž‹ï¼Œè®©æ¨¡åž‹å­¦ä¼šå¤„ç†ç‚«å…‰å¹²æ‰°
- æµ‹è¯•é˜¶æ®µï¼šä½¿ç”¨æ— ç‚«å…‰çš„å›¾ç‰‡éªŒè¯æ¨¡åž‹åœ¨ç†æƒ³æ¡ä»¶ä¸‹çš„é‡å»ºè´¨é‡
- ä½å§¿å®Œå…¨ç›¸åŒç¡®ä¿äº†è®­ç»ƒå’Œæµ‹è¯•çš„ä¸€è‡´æ€§

## ðŸ“¦ æ¨¡å—è¯¦ç»†è¯´æ˜Ž

### 3D Gaussian Splatting (`gaussian-splatting/`)
**åŠŸèƒ½**: å®žæ—¶3Dåœºæ™¯é‡å»ºå’Œæ–°è§†è§’åˆæˆ
**ç‰¹è‰²**: é›†æˆäº†PDTSæ™ºèƒ½è§†å›¾é€‰æ‹©ç®—æ³•ï¼Œæå‡è®­ç»ƒæ•ˆçŽ‡

#### æ ¸å¿ƒç‰¹æ€§:
- **å®žæ—¶æ¸²æŸ“**: â‰¥30fpsçš„1080pæ–°è§†è§’åˆæˆ
- **æ™ºèƒ½è§†å›¾é€‰æ‹©**: PDTSç¥žç»ç½‘ç»œé¢„æµ‹æŸå¤±ï¼Œæ›¿ä»£ç›´æŽ¥è®¡ç®—
- **æ··åˆé‡‡æ ·ç­–ç•¥**: Bootstrapé˜¶æ®µéšæœºé‡‡æ · + Hybridé˜¶æ®µç½‘ç»œæŒ‡å¯¼é‡‡æ ·
- **é«˜è´¨é‡é‡å»º**: ä¿æŒSOTAè§†è§‰è´¨é‡çš„åŒæ—¶æå‡è®­ç»ƒé€Ÿåº¦

#### å…³é”®æ–‡ä»¶:
- `train.py`: ä¸»è®­ç»ƒè„šæœ¬ï¼ˆé›†æˆPDTSé€‰æ‹©é€»è¾‘ï¼‰
- `render.py`: æ¸²æŸ“è„šæœ¬ï¼Œç”Ÿæˆæ–°è§†è§’å›¾åƒ
- `pdts_integration.py`: PDTSé£Žé™©å­¦ä¹ å™¨å®žçŽ°
- `scene/`: åœºæ™¯æ•°æ®åŠ è½½å’Œç®¡ç†
- `gaussian_renderer/`: é«˜æ–¯å…‰æ …åŒ–æ¸²æŸ“å™¨

#### è¿è¡ŒçŽ¯å¢ƒ:
- **æŽ¨è**: Windows + CUDA GPU
- **åŽŸå› **: ç”¨æˆ·ç†Ÿæ‚‰WindowsçŽ¯å¢ƒï¼ŒGPUåŠ é€Ÿæ•ˆæžœæ›´å¥½

### DVSäº‹ä»¶ç›¸æœºä»¿çœŸå™¨ (`DVS-Voltmeter-main/`)  
**åŠŸèƒ½**: åŸºäºŽéšæœºè¿‡ç¨‹çš„DVSäº‹ä»¶ç›¸æœºä»¿çœŸå™¨
**è®ºæ–‡**: "DVS-Voltmeter: Stochastic Process-based Event Simulator" (ECCV 2022)

#### æ ¸å¿ƒç®—æ³•:
- **éšæœºè¿‡ç¨‹å»ºæ¨¡**: æ¨¡æ‹ŸçœŸå®žDVSä¼ æ„Ÿå™¨çš„å™ªå£°ç‰¹æ€§
- **åƒç´ çº§ä»¿çœŸ**: æ¯ä¸ªåƒç´ ç‹¬ç«‹çš„äº‹ä»¶ç”Ÿæˆè¿‡ç¨‹
- **å‚æ•°åŒ–æ¨¡åž‹**: æ”¯æŒDVS346ã€DVS240ç­‰ä¸åŒç›¸æœºåž‹å·

#### è¾“å…¥è¦æ±‚:
- é«˜å¸§çŽ‡å›¾åƒåºåˆ—ï¼ˆé€šè¿‡è§†é¢‘æ’å€¼èŽ·å¾—ï¼‰
- å›¾åƒæ ¼å¼: PNGæ ¼å¼ï¼ŒæŒ‰æ•°å­—ç¼–å·å‘½å
- é…ç½®æ–‡ä»¶: `info.txt` æè¿°åºåˆ—ä¿¡æ¯

#### è¾“å‡ºæ•°æ®:
- äº‹ä»¶æ•°æ®æµ: (x, y, timestamp, polarity)
- å¯è§†åŒ–ç»“æžœ: äº‹ä»¶ä½“ç´ ç½‘æ ¼è¡¨ç¤º

#### å…³é”®æ–‡ä»¶:
- `main.py`: ä¸»ä»¿çœŸè„šæœ¬
- `src/simulator.py`: äº‹ä»¶ä»¿çœŸå™¨æ ¸å¿ƒç®—æ³•  
- `src/config.py`: ç›¸æœºå‚æ•°é…ç½®
- `src/visualize.py`: äº‹ä»¶æ•°æ®å¯è§†åŒ–

## ðŸ”„ æ•°æ®æµå‘è®¾è®¡

```
åŽŸå§‹æ•°æ®é›† â†’ æ•°æ®é¢„å¤„ç† â†’ 3DGSè®­ç»ƒ â†’ å›¾åƒåºåˆ—ç”Ÿæˆ â†’ äº‹ä»¶ä»¿çœŸ â†’ äº‹ä»¶æ•°æ®é›†
    â†“              â†“           â†“            â†“           â†“
lego_flare/   merge_datasets  gaussian-    render.py   DVS-Voltmeter  
lego_normal/       â†“         splatting/      â†“             â†“
    â†“         datasets/lego/     â†“       é«˜å¸§çŽ‡å›¾åƒ     events.txt
åˆå¹¶æ•°æ®é›†      è®­ç»ƒæµ‹è¯•åˆ†ç¦»    3Dæ¨¡åž‹      åºåˆ—        + å¯è§†åŒ–
```

## ðŸ“‹ å®žéªŒTODOæ¸…å•

### è¿‘æœŸä»»åŠ¡ (ç”¨æˆ·æ‰§è¡Œ):
1. **3DGSè®­ç»ƒæµ‹è¯•**: åœ¨WindowsçŽ¯å¢ƒè¿è¡Œgaussian-splatting
2. **å›¾åƒåºåˆ—ç”Ÿæˆ**: ä½¿ç”¨è®­ç»ƒå¥½çš„æ¨¡åž‹æ¸²æŸ“é«˜å¸§çŽ‡å›¾åƒåºåˆ—  
3. **åºåˆ—è´¨é‡æ£€æŸ¥**: ç¡®ä¿å›¾åƒè¿žç»­æ€§å’Œæ—¶é—´ä¸€è‡´æ€§

### ä¸­æœŸä»»åŠ¡ (äº‹ä»¶ä»¿çœŸ):
1. **DVSä»¿çœŸå‡†å¤‡**: å‡†å¤‡é«˜å¸§çŽ‡å›¾åƒåºåˆ—è¾“å…¥
2. **å‚æ•°è°ƒä¼˜**: è°ƒæ•´DVSç›¸æœºå‚æ•°åŒ¹é…å®žéªŒéœ€æ±‚
3. **ä»¿çœŸæ‰§è¡Œ**: ç”Ÿæˆäº‹ä»¶æ•°æ®å’Œå¯è§†åŒ–ç»“æžœ
4. **è´¨é‡è¯„ä¼°**: äº‹ä»¶æ•°æ®çš„å™ªå£°æ°´å¹³å’ŒçœŸå®žæ€§åˆ†æž

### é•¿æœŸä»»åŠ¡ (ç³»ç»Ÿé›†æˆ):
1. **ç«¯åˆ°ç«¯Pipeline**: è‡ªåŠ¨åŒ–å®Œæ•´å·¥ä½œæµç¨‹
2. **å¤šåœºæ™¯æ‰©å±•**: æ”¯æŒæ›´å¤šæ•°æ®é›†å’Œåœºæ™¯ç±»åž‹
3. **æ€§èƒ½ä¼˜åŒ–**: å„æ¨¡å—çš„é€Ÿåº¦å’Œå†…å­˜ä¼˜åŒ–
4. **ç»“æžœåˆ†æž**: ç‚«å…‰å¯¹äº‹ä»¶ç›¸æœºä»¿çœŸå½±å“çš„å®šé‡åˆ†æž

## çŽ¯å¢ƒè¦æ±‚

### LinuxçŽ¯å¢ƒ (å½“å‰WSL2):
- Python 3.x
- UmainçŽ¯å¢ƒï¼ˆå·²æœ‰ç›¸å…³Pythonåº“ï¼‰
- ç”¨äºŽæ•°æ®é¢„å¤„ç†å’Œåˆ†æž

### WindowsçŽ¯å¢ƒ (ç”¨æˆ·è´Ÿè´£):
- CUDAæ”¯æŒçš„GPU
- Python + PyTorch
- ç”¨äºŽ3DGSè®­ç»ƒå’Œæ¸²æŸ“

### DVSä»¿çœŸçŽ¯å¢ƒ:
```bash
easydict == 1.9
pytorch >= 1.8  
numpy >= 1.20.1
opencv-python == 4.5.1.48
tqdm == 4.49.0
```